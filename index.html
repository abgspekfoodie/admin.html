<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snapbite™ Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 1rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    h1, h2 {
      color: #ff9500;
    }
    .section {
      background: #1e1e1e;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 2rem;
    }
    .toggle-switch {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    input[type="checkbox"] {
      width: 40px;
      height: 20px;
      appearance: none;
      background: #444;
      border-radius: 10px;
      position: relative;
      outline: none;
      cursor: pointer;
    }
    input[type="checkbox"]:checked {
      background: #ff9500;
    }
    input[type="checkbox"]::before {
      content: "";
      position: absolute;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      top: 1px;
      left: 1px;
      transition: 0.3s;
    }
    input[type="checkbox"]:checked::before {
      left: 21px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #222;
    }
    canvas {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>Snapbite™ Admin Panel</h1>  <div class="section">
    <h2>Shop Status</h2>
    <div class="toggle-switch">
      <input type="checkbox" id="offdayToggle">
      <label id="offdayLabel">Shop is OPEN</label>
    </div>
  </div>  <div class="section">
    <h2>Menu & Add-on Availability</h2>
    <table id="menuTable">
      <thead><tr><th>Category</th><th>Item</th><th>Available</th></tr></thead>
      <tbody id="menuBody"></tbody>
    </table>
    <table id="addonTable">
      <thead><tr><th>Add-on</th><th>Available</th></tr></thead>
      <tbody id="addonBody"></tbody>
    </table>
  </div>  <div class="section">
    <h2>Sales Summary</h2>
    <canvas id="salesChart" height="150"></canvas>
  </div>  <div class="section">
    <h2>Archived Orders</h2>
    <div id="archive"></div>
  </div><script>
const firebaseConfig = {
  apiKey: "AIzaSyB_gnrfNMlJaNu6zSZqX7eiXzbZrnmtA2M",
  authDomain: "snapbite-admin.firebaseapp.com",
  databaseURL: "https://snapbite-admin-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "snapbite-admin",
  storageBucket: "snapbite-admin.appspot.com",
  messagingSenderId: "146625734660",
  appId: "1:146625734660:web:23ada593e4818ed7332d51"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const menuData = {
  "Beef": ["Primebite™", "Beef N’ Cheese™", "The Fun Guy™", "The Fixer™"],
  "Chicken": ["Chickbite™", "Goldcut™", "The Cap Cut™", "Stripstack™"],
  "Tex-Mex": ["Smoke Beef Taco™", "Smokey Chicken Taco™", "Mix Taco™", "Smoke Beef Quesadilla™", "Smoke Chicken Quesadilla™", "Mix Quesadilla™"],
  "Sausage": ["Classic Sausage™", "Loaded Sausage™"]
};

const addons = ["Cheese", "Egg", "Bacon"];

const toggleShop = document.getElementById("offdayToggle");
const labelShop = document.getElementById("offdayLabel");

// Shop toggle
function loadShopStatus() {
  db.ref("settings/offday").on("value", snap => {
    toggleShop.checked = !!snap.val();
    labelShop.textContent = toggleShop.checked ? "Shop is CLOSED" : "Shop is OPEN";
  });
  toggleShop.addEventListener("change", () => {
    db.ref("settings/offday").set(toggleShop.checked);
  });
}

function renderMenuAvailability() {
  const menuBody = document.getElementById("menuBody");
  const addonBody = document.getElementById("addonBody");
  db.ref("menuAvailability").once("value", snap => {
    const avail = snap.val() || {};
    menuBody.innerHTML = "";
    for (const cat in menuData) {
      for (const item of menuData[cat]) {
        const id = item.toLowerCase().replace(/[^a-z0-9]/gi, "");
        const available = avail[id] !== false;
        const row = `<tr><td>${cat}</td><td>${item}</td><td><input type='checkbox' data-id='${id}' ${available ? "checked" : ""}></td></tr>`;
        menuBody.innerHTML += row;
      }
    }
    menuBody.querySelectorAll("input[type='checkbox']").forEach(cb => {
      cb.addEventListener("change", e => {
        const id = e.target.dataset.id;
        db.ref("menuAvailability/" + id).set(e.target.checked);
      });
    });
  });
  db.ref("addonAvailability").once("value", snap => {
    const avail = snap.val() || {};
    addonBody.innerHTML = "";
    for (const addon of addons) {
      const id = addon.toLowerCase();
      const available = avail[id] !== false;
      const row = `<tr><td>${addon}</td><td><input type='checkbox' data-id='${id}' ${available ? "checked" : ""}></td></tr>`;
      addonBody.innerHTML += row;
    }
    addonBody.querySelectorAll("input[type='checkbox']").forEach(cb => {
      cb.addEventListener("change", e => {
        const id = e.target.dataset.id;
        db.ref("addonAvailability/" + id).set(e.target.checked);
      });
    });
  });
}

function loadSalesGraph() {
  db.ref("orders").once("value", snap => {
    const data = snap.val() || {};
    const dates = {};
    Object.values(data).forEach(o => {
      const d = new Date(o.time).toLocaleDateString();
      dates[d] = (dates[d] || 0) + o.total;
    });
    const labels = Object.keys(dates);
    const values = Object.values(dates);
    new Chart(document.getElementById("salesChart"), {
      type: 'bar',
      data: { labels, datasets: [{ label: "Total Sales (RM)", backgroundColor: '#ff9500', data: values }] },
      options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
    });
  });
}

function loadArchives() {
  db.ref("orders").once("value", snap => {
    const data = snap.val() || {};
    const container = document.getElementById("archive");
    container.innerHTML = Object.entries(data).reverse().slice(0, 10).map(([id, o]) => {
      const time = new Date(o.time).toLocaleString();
      const lines = o.items.map(i => `${i.name} x${i.quantity}`).join(", ");
      return `<div><strong>${time}</strong><br>${lines}<br>Total: RM ${o.total.toFixed(2)}<hr></div>`;
    }).join("");
  });
}

loadShopStatus();
renderMenuAvailability();
loadSalesGraph();
loadArchives();
</script></body>
</html>
