<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8">
  <title>Snapbite™ Admin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; background: #0e0e0e; color: #fff; padding: 2rem; }
    h1 { color: #ff9500; }
    .card { background: #1c1c1c; border-radius: 10px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 0 10px rgba(255,149,0,0.2); }
    .flex { display: flex; gap: 1.5rem; flex-wrap: wrap; }
    .menu-item { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
    .menu-item button { background: #ff9500; color: #000; border: none; padding: 4px 10px; border-radius: 5px; cursor: pointer; }
    .stats { display: flex; flex-direction: column; gap: 0.3rem; }
    .offday-toggle { margin-top: 1rem; }
    .orders { font-size: 0.9rem; line-height: 1.4; }
    .order-block { border-bottom: 1px solid #333; padding: 0.5rem 0; }
  </style>
</head>
<body>
  <h1>Snapbite™ Admin Panel</h1>  <div class="card">
    <h2>Menu Availability</h2>
    <div id="menuList">Loading menu...</div>
  </div>  <div class="card">
    <h2>Sales Summary</h2>
    <div class="stats" id="salesStats">Loading sales...</div>
    <div class="offday-toggle">
      <label>
        <input type="checkbox" id="offdayCheckbox"> Mark Today as Off Day
      </label>
    </div>
  </div>  <div class="card">
    <h2>Live Orders</h2>
    <div id="liveOrders">Loading orders...</div>
  </div><script>
  const firebaseConfig = {
    apiKey: "AIzaSyB_gnrfNMlJaNu6zSZqX7eiXzbZrnmtA2M",
    authDomain: "snapbite-admin.firebaseapp.com",
    databaseURL: "https://snapbite-admin-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "snapbite-admin",
    storageBucket: "snapbite-admin.appspot.com",
    messagingSenderId: "146625734660",
    appId: "1:146625734660:web:23ada593e4818ed7332d51",
    measurementId: "G-7RR3W1WJYK"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const menuList = document.getElementById("menuList");
  const salesStats = document.getElementById("salesStats");
  const offdayCheckbox = document.getElementById("offdayCheckbox");
  const liveOrders = document.getElementById("liveOrders");

  db.ref("menus").on("value", snap => {
    const menus = snap.val();
    if (!menus || menus.length === 0) {
      menuList.innerHTML = "<em>No menu items found.</em>";
      return;
    }
    menuList.innerHTML = '';
    menus.forEach((menu, index) => {
      const row = document.createElement("div");
      row.className = "menu-item";
      row.innerHTML = `
        <span>${menu.name} (RM${menu.price.toFixed(2)})</span>
        <button onclick="toggleMenu(${index}, ${!menu.available})">
          ${menu.available ? 'Disable' : 'Enable'}
        </button>`;
      menuList.appendChild(row);
    });
  });

  function toggleMenu(index, newStatus) {
    db.ref(`menus/${index}/available`).set(newStatus);
  }

  const today = new Date().toISOString().split('T')[0];
  const currentMonth = today.slice(0, 7);
  const lastMonth = new Date(new Date().setMonth(new Date().getMonth() - 1)).toISOString().slice(0, 7);

  function displaySales(monthData, label) {
    return monthData ? `<div><strong>${label} Gross:</strong> RM${monthData.gross.toFixed(2)}</div>
      <div><strong>${label} Net:</strong> RM${monthData.net.toFixed(2)}</div>
      <div><strong>${label} Profit:</strong> RM${monthData.profit.toFixed(2)}</div>` : `<i>No data for ${label}</i>`;
  }

  Promise.all([
    db.ref(`salesSummary/${currentMonth}`).once("value"),
    db.ref(`salesSummary/${lastMonth}`).once("value")
  ]).then(([currSnap, lastSnap]) => {
    const current = currSnap.val();
    const previous = lastSnap.val();
    salesStats.innerHTML = displaySales(current, "This Month") + '<br>' + displaySales(previous, "Last Month");
  });

  db.ref(`offdays/${today}`).once("value").then(snap => {
    offdayCheckbox.checked = snap.val() === true;
  });
  offdayCheckbox.addEventListener("change", () => {
    db.ref(`offdays/${today}`).set(offdayCheckbox.checked);
    alert("Offday status updated.");
  });

  // Live Orders
  db.ref("orders").limitToLast(20).on("value", snap => {
    const data = snap.val();
    if (!data) {
      liveOrders.innerHTML = "<i>No orders yet.</i>";
      return;
    }
    const entries = Object.entries(data).reverse();
    liveOrders.innerHTML = '';
    entries.forEach(([key, order]) => {
      const block = document.createElement("div");
      block.className = "order-block";
      block.innerHTML = `<strong>${order.name}</strong> (${order.phone})<br>
        Items: ${order.items.map(i => i.name).join(", ")}<br>
        Total: RM${order.total} — ${new Date(order.timestamp).toLocaleString()}`;
      liveOrders.appendChild(block);
    });
  });
</script></body>
</html>
