<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snapbite™ Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #eee;
      margin: 0; padding: 1rem;
      max-width: 900px;
      margin-left: auto; margin-right: auto;
    }
    h1 { color: #ff9500; text-align: center; margin-bottom: 1rem; }
    .section {
      background: #1e1e1e;
      padding: 1rem 1.2rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
    }
    .toggle-switch {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .toggle-switch input[type="checkbox"] {
      width: 40px; height: 20px;
      appearance: none; background: #333; border-radius: 20px;
      position: relative; outline: none; transition: background 0.3s; cursor: pointer;
    }
    .toggle-switch input[type="checkbox"]:checked { background: #ff9500; }
    .toggle-switch input[type="checkbox"]::before {
      content: "";
      position: absolute; width: 18px; height: 18px;
      border-radius: 50%; top: 1px; left: 1px; background: #fff;
      transition: 0.3s;
    }
    .toggle-switch input[type="checkbox"]:checked::before { left: 21px; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 0.7rem;
    }
    th, td {
      border: 1px solid #444; padding: 8px 12px; text-align: left;
    }
    th { background: #222; }
    .available { color: #00ff00; font-weight: bold; }
    .unavailable { color: #ff3b3b; font-weight: bold; }
    .report-box {
      background: #222; border-radius: 10px; padding: 1rem;
      margin: 0.5rem 0;
    }
    .report-box h3 { color: #ff9500; margin-top: 0; }
    .loading { text-align: center; font-style: italic; margin-top: 1rem; }
    .archive-table { font-size: 0.9rem; }
  </style>
</head>
<body>

<h1>Snapbite™ Admin Panel</h1>

<div class="section">
  <h2>Shop Status</h2>
  <div class="toggle-switch">
    <input type="checkbox" id="offdayToggle" />
    <label for="offdayToggle" id="offdayLabel">Shop is OPEN</label>
  </div>
</div>

<div class="section">
  <h2>Add-on Availability</h2>
  <div class="toggle-switch">
    <input type="checkbox" id="addon-cheese" /> <label for="addon-cheese">Cheese</label>
    <input type="checkbox" id="addon-egg" /> <label for="addon-egg">Egg</label>
    <input type="checkbox" id="addon-bacon" /> <label for="addon-bacon">Bacon</label>
  </div>
</div>

<div class="section">
  <h2>Sales Report (Today)</h2>
  <div class="report-box">
    <h3>Total Sales</h3>
    <p id="todayTotal">RM 0.00</p>
  </div>
  <div class="loading" id="salesLoading">Loading sales data...</div>
</div>

<div class="section">
  <h2>Order Archive</h2>
  <table class="archive-table">
    <thead><tr><th>Name</th><th>Time</th><th>Total (RM)</th></tr></thead>
    <tbody id="archiveBody"><tr><td colspan="3">Loading...</td></tr></tbody>
  </table>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB_gnrfNMlJaNu6zSZqX7eiXzbZrnmtA2M",
    authDomain: "snapbite-admin.firebaseapp.com",
    databaseURL: "https://snapbite-admin-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "snapbite-admin",
    storageBucket: "snapbite-admin.appspot.com",
    messagingSenderId: "146625734660",
    appId: "1:146625734660:web:23ada593e4818ed7332d51"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const offdayToggle = document.getElementById("offdayToggle");
  const offdayLabel = document.getElementById("offdayLabel");
  const todayTotal = document.getElementById("todayTotal");
  const salesLoading = document.getElementById("salesLoading");
  const archiveBody = document.getElementById("archiveBody");

  // Offday toggle
  db.ref("settings/offday").on("value", snap => {
    const val = snap.val();
    offdayToggle.checked = !!val;
    updateOffdayLabel();
  });
  function updateOffdayLabel() {
    if (offdayToggle.checked) {
      offdayLabel.textContent = "Shop is CLOSED (Off Day)";
      offdayLabel.style.color = "#ff3b3b";
    } else {
      offdayLabel.textContent = "Shop is OPEN";
      offdayLabel.style.color = "#00ff00";
    }
  }
  offdayToggle.addEventListener("change", () => {
    db.ref("settings/offday").set(offdayToggle.checked);
  });

  // Addon availability
  ["cheese", "egg", "bacon"].forEach(id => {
    const el = document.getElementById("addon-" + id);
    db.ref("addons/" + id).on("value", snap => {
      el.checked = !!snap.val();
    });
    el.addEventListener("change", () => {
      db.ref("addons/" + id).set(el.checked);
    });
  });

  // Sales Report - today only
  function isToday(dateStr) {
    const d = new Date(dateStr);
    const now = new Date();
    return d.getDate() === now.getDate() && d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
  }

  db.ref("orders").on("value", snap => {
    const data = snap.val() || {};
    let totalToday = 0;
    archiveBody.innerHTML = "";
    const rows = [];

    Object.values(data).reverse().forEach(o => {
      const t = new Date(o.time || "");
      const timeStr = t.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const dateStr = t.toLocaleDateString();

      if (isToday(o.time)) totalToday += o.total || 0;

      rows.push(`<tr><td>${o.name || "-"}</td><td>${dateStr} ${timeStr}</td><td>${(o.total || 0).toFixed(2)}</td></tr>`);
    });

    todayTotal.textContent = "RM " + totalToday.toFixed(2);
    archiveBody.innerHTML = rows.join("\n");
    salesLoading.style.display = "none";
  });
</script>

</body>
</html>
